# הגדרת שליחת מיילים - טוטו שלוש

## סקירה כללית

מערכת הגיבויים תומכת כעת בשליחת גיבויים אוטומטית למייל. המערכת משתמשת ב-Resend API לשליחת מיילים.

## 🔧 הגדרה

### 1. יצירת חשבון Resend

1. היכנס ל-[Resend.com](https://resend.com)
2. צור חשבון חדש (חינמי עד 3,000 מיילים בחודש)
3. אמת את כתובת המייל שלך

### 2. קבלת API Key

1. היכנס ל-Dashboard של Resend
2. לך ל-API Keys
3. צור API Key חדש
4. העתק את המפתח

### 3. הגדרת משתני סביבה

#### בלוקאל (.env.local):
```bash
RESEND_API_KEY=re_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
ADMIN_EMAIL=your-email@example.com
```

#### בפרודקשן (Vercel):
1. היכנס ל-Vercel Dashboard
2. בחר את הפרויקט
3. לך ל-Settings → Environment Variables
4. הוסף:
   - `RESEND_API_KEY` = `re_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`
   - `ADMIN_EMAIL` = `your-email@example.com`

### 4. הגדרת כתובת מייל במערכת

1. היכנס לדף הניהול (`/admin`)
2. לך לטאב "הגדרות"
3. מלא את השדה "כתובת מייל לגיבויים"
4. שמור את ההגדרות

## 📧 תכונות המייל

### תוכן המייל
- **כותרת**: "גיבוי נתונים - טוטו שלוש - [תאריך]"
- **תוכן HTML**: עיצוב יפה עם פרטי הגיבוי
- **קובץ מצורף**: קובץ JSON עם כל נתוני הגיבוי
- **פרטי הגיבוי**: תאריך, גודל, סוגי נתונים

### שליחה אוטומטית
- **גיבוי אוטומטי**: כל 5 דקות לאחר שינויים
- **גיבוי ידני**: דרך כפתור "שלח גיבוי למייל"
- **גיבוי מ-API**: דרך `/api/backup?action=create`

## 🛠️ שימוש

### שליחה אוטומטית
המערכת שולחת מייל אוטומטית בכל פעם שנוצר גיבוי, אם:
- מוגדר `ADMIN_EMAIL` במשתני הסביבה, או
- מוגדר `adminEmail` בהגדרות המערכת

### שליחה ידנית
1. היכנס לדף הניהול
2. לחץ על "שלח גיבוי למייל"
3. המערכת תיצור גיבוי ותשלח אותו למייל

### API ישיר
```bash
# יצירת גיבוי
curl -X GET "https://your-domain.com/api/backup?action=create"

# שליחת מייל
curl -X POST "https://your-domain.com/api/send-email" \
  -H "Content-Type: application/json" \
  -d '{
    "to": "admin@example.com",
    "subject": "Test Email",
    "message": "This is a test email"
  }'
```

## 🔍 פתרון בעיות

### שגיאות נפוצות

#### "Email service not configured"
- וודא שה-`RESEND_API_KEY` מוגדר נכון
- בדוק שהמפתח תקין ב-Resend Dashboard

#### "Failed to send email"
- בדוק את כתובת המייל
- וודא שהמפתח לא פג תוקף
- בדוק את הלוגים ב-Vercel

#### "Backup email sent successfully" אבל לא מגיע
- בדוק את תיקיית הספאם
- וודא שכתובת המייל נכונה
- בדוק ב-Resend Dashboard אם המייל נשלח

### בדיקת הגדרות
```bash
# בדוק אם המשתנים מוגדרים
echo $RESEND_API_KEY
echo $ADMIN_EMAIL
```

## 📊 מעקב

### Resend Dashboard
- צפה בסטטיסטיקות שליחת מיילים
- בדוק את סטטוס המיילים
- עקוב אחר שגיאות

### לוגים
- בדוק את הלוגים ב-Vercel
- חפש הודעות "Backup email sent successfully"
- עקוב אחר שגיאות שליחת מיילים

## 💡 טיפים

1. **בדיקה ראשונית**: שלח מייל בדיקה לפני ההפעלה
2. **גיבוי חלופי**: שמור גיבויים גם במקום אחר
3. **מעקב שגיאות**: בדוק את הלוגים באופן קבוע
4. **עדכון כתובת**: עדכן את כתובת המייל במידת הצורך

## 🔒 אבטחה

- המפתח API נשמר במשתני סביבה
- המיילים נשלחים רק לכתובת מוגדרת
- אין חשיפת נתונים רגישים במייל
- הגיבוי מוצפן בקובץ המצורף

## 📞 תמיכה

אם נתקלת בבעיות:
1. בדוק את הלוגים
2. וודא את ההגדרות
3. בדוק את Resend Dashboard
4. פנה לתמיכה טכנית
